(function(){"use strict";angular.module("app-timelines").controller("timelinesController",["$scope","$http",function(n){function h(){return[{name:"xs",intervals:f("xs"),timelines:e("xs")},{name:"sm",intervals:f("sm"),timelines:e("sm")},{name:"md",intervals:f("md"),timelines:e("md")},{name:"lg",intervals:f("lg"),timelines:e("lg")},]}function t(n){var t=3;switch(n){case"xs":t=1;break;case"sm":t=2;break;case"md":t=2;break;case"lg":t=3}return t}function f(i){for(var f=[],e=t(i),r=n.currentYear,u=0;u<e;u++)f[u]=r<0?r*-1+" B.C.E":r===0?"1 C.E":r+" C.E",r+=n.config.yearsPerInterval;return f}function e(i){var f=t(i),r=n.currentYear-n.config.yearsPerInterval/2,u=r+f*n.config.yearsPerInterval;return n.timelines.filter(function(n){var t=n.start,i=n.end;return n.unknownStart!==null&&n.unknownStart<n.start&&(t=n.unknownStart),n.unknownEnd!==null&&n.unknownEnd>n.end&&(i=n.unknownEnd),t>=r&&t<u||i>r&&i<=u||t<r&&i>u})}function v(n){var t={start:0,end:0};return t.start=n.start,t.end=n.end,n.unknownStart!==null&&n.unknownStart<n.start&&(t.start=n.unknownStart),n.unknownEnd!==null&&n.unknownEnd>n.end&&(t.end=n.unknownEnd),t}function y(t){return n.timelines.filter(function(n){return n.id==t})}function p(i,r){var f=t(r),u=n.currentYear-n.config.yearsPerInterval/2,e=u+f*n.config.yearsPerInterval;return i.filter(function(n){return n.year>=u&&n.year<=e})}function w(i,r,u){var c=t(u),f=0,e=n.currentYear-n.config.yearsPerInterval/2,s=e+c*n.config.yearsPerInterval,l=b(r),o=i.previousEventYear,h=i.year;return o===null&&(o=l),o<e&&(o=e),h>s&&(h=s),f=(h-o)*n.pixelsPerYear,f-=10,i.previousEventYear!==null&&i.previousEventYear>=e&&(f-=10),i.previousEventYear!==null&&i.previousEventYear===e&&(f-=10),i.year===s&&(f-=10),f}function b(t){var r=n.currentYear-n.config.yearsPerInterval/2,i=t.start;return t.unknownStart!==null&&t.unknownStart<t.start&&(i=t.unknownStart),i<r&&(i=r),i}function c(i,r){var s=t(r),e=0,f=n.currentYear-n.config.yearsPerInterval/2,o=f+s*n.config.yearsPerInterval,u=i.start;return i.unknownStart!==null&&i.unknownStart<i.start&&(u=i.unknownStart),u>o&&(u=o),u>=f&&(e=(u-f)*n.pixelsPerYear),e}function k(i,r){var h=t(r),s=0,e=n.currentYear-n.config.yearsPerInterval/2,o=e+h*n.config.yearsPerInterval,u=i.start,f=i.end;return i.unknownStart!==null&&i.unknownStart<i.start&&(u=i.unknownStart),u<e&&(u=e),i.unknownEnd!==null&&i.unknownEnd>i.end&&(f=i.unknownEnd),f>o&&(f=o),u>=e&&u<o&&u<f&&(s=(f-u)*n.pixelsPerYear),s}function l(i,r){var o=t(r),s=0,f=n.currentYear-n.config.yearsPerInterval/2,h=f+o*n.config.yearsPerInterval,u,e;return i.unknownStart!==null&&i.unknownStart<i.start&&(u=i.unknownStart,e=i.start,u<f&&(u=f),e>f+o*n.config.yearsPerInterval&&(e=f+o*n.config.yearsPerInterval),u>=f&&u<h&&u<e&&(s=(e-u)*n.pixelsPerYear)),s}function o(i,r){var h=t(r),s=0,f=n.currentYear-n.config.yearsPerInterval/2,o=f+h*n.config.yearsPerInterval,u=i.start,e=i.end;return u<f&&(u=f),e>o&&(e=o),u>=f&&u<o&&u<e&&(s=(e-u)*n.pixelsPerYear),s}function a(i,r){var o=t(r),s=0,f=n.currentYear-n.config.yearsPerInterval/2,h=f+o*n.config.yearsPerInterval,u,e;return i.unknownEnd!==null&&i.unknownEnd>i.end&&(u=i.end,e=i.unknownEnd,u<f&&(u=f),e>f+o*n.config.yearsPerInterval&&(e=f+o*n.config.yearsPerInterval),u>=f&&u<h&&u<e&&(s=(e-u)*n.pixelsPerYear)),s}var i,u,r,s;for(n.timelines=[{id:1,name:"Adam",meaning:"Earthling Man, Mankind",start:-4026,end:-3970,unknownStart:null,unknownEnd:null,image:"http://i.imgur.com/00n9NWT.jpg",parents:[],children:[3,4],spouse:[2],siblings:[],isSelected:!1,events:[{name:"event 1",year:-4026,previousEventYear:null,text:"#hello, markdown!"},{name:"event 2",year:-4005,previousEventYear:-4026,text:"[Google](http://www.google.de)"},{name:"event 3",year:-4004,previousEventYear:-4005,text:"Event 3 Text"},{name:"event 4",year:-4003,previousEventYear:-4004,text:"Event 4 Text"},{name:"event 5",year:-4e3,previousEventYear:-4003,text:"Event 5 Text"},{name:"event 6",year:-3975,previousEventYear:-4e3,text:"Event 6 Text"}]},{id:2,name:"Eve",meaning:"Living One",start:-4e3,end:-3970,unknownStart:-4026,unknownEnd:-3965,image:"http://i.imgur.com/00n9NWT.jpg",parents:[],children:[3,4],spouse:[1],siblings:[],isSelected:!1,events:[{name:"event 1",year:-3975,previousEventYear:null,text:"Event 1 Text"},{name:"event 2",year:-3965,previousEventYear:-3975,text:"Event 2 Text"}]},{id:3,name:"Cain",meaning:"Something Produced",start:-3990,end:-3960,unknownStart:-4026,unknownEnd:-3955,image:null,parents:[1,2],children:[],spouse:[],siblings:[4],isSelected:!1,events:[{name:"event 1",year:-3995,previousEventYear:null,text:"Event 1 Text"}]},{id:4,name:"Abel",meaning:"possibly, Exhalation; Vanity",start:-3985,end:-3960,unknownStart:-4026,unknownEnd:-3955,image:"http://i.imgur.com/00n9NWT.jpg",parents:[1,2],children:[],spouse:[],siblings:[3],isSelected:!1,events:[{name:"event 1",year:-3985,previousEventYear:null,text:"Event 1 Text"}]}],n.config={intervalWidth:360,yearsPerInterval:100,startYear:-4030,endYear:2020},n.currentYear=n.config.startYear,n.intervalYears=[1,5,10,50,100],n.years=[],i=0;i<n.config.endYear-n.currentYear+1;i++)u=n.currentYear+i,r=n.currentYear+i,u!==0&&(r=u<0?r+" B.C.E":r+" C.E",s={value:u,name:r},n.years.push(s));n.selectedYear=n.years[0];n.sizes=h();n.pixelsPerYear=n.config.intervalWidth/n.config.yearsPerInterval;n.changeConfig=function(){n.currentYear=n.selectedYear.value;n.sizes=h();n.pixelsPerYear=n.config.intervalWidth/n.config.yearsPerInterval};n.parents=[];n.children=[];n.spouse=[];n.siblings=[];n.setHighlights=function(t){n.clearHighlights();var i=y(t);n.parents=[];n.children=[];n.spouse=[];n.siblings=[];i[0].parents.length&&n.parents.push.apply(n.parents,i[0].parents);i[0].children.length&&n.children.push.apply(n.children,i[0].children);i[0].spouse.length&&n.spouse.push.apply(n.spouse,i[0].spouse);i[0].siblings.length&&n.siblings.push.apply(n.siblings,i[0].siblings)};n.clearHighlights=function(){n.parents=[];n.children=[];n.spouse=[]};n.isParent=function(t){return n.parents.indexOf(t)!==-1};n.isChild=function(t){return n.children.indexOf(t)!==-1};n.isSpouse=function(t){return n.spouse.indexOf(t)!==-1};n.isSibling=function(t){return n.siblings.indexOf(t)!==-1};n.fastBackward=function(i){var f=t(i),r=n.config.startYear,u=n.years.filter(function(n){return n.value===r});n.selectedYear=u[0];n.changeConfig()};n.backward=function(i){var r=t(i),u=n.currentYear-n.config.yearsPerInterval*r,f=n.years.filter(function(n){return n.value===u});n.selectedYear=f[0];n.changeConfig()};n.forward=function(i){var r=t(i),u=n.currentYear+n.config.yearsPerInterval*r,f=n.years.filter(function(n){return n.value===u});n.selectedYear=f[0];n.changeConfig()};n.fastForward=function(i){var r=t(i),u=n.config.endYear-n.config.yearsPerInterval*(r-1),f=n.years.filter(function(n){return n.value===u});n.selectedYear=f[0];n.changeConfig()};n.getTimelineWidth=function(i){var r=t(i),u=n.config.intervalWidth*r+"px";return{width:u}};n.getTimelineClass=function(n){return"visible-"+n+"-block"};n.getTimelineTitle=function(t){var i=t.name+" ["+t.meaning+"] \n";return i+n.getTimelineRangeString(t)};n.getTimelineRangeString=function(n){var i="",t=v(n);return i+=t.start<0?t.start*-1+" B.C.E":t.start+" C.E",i+=" - ",i+(t.end<0?t.end*-1+" B.C.E":t.end+" C.E")};n.getEventYearString=function(n){return""+(n<0?n*-1+" B.C.E":n+" C.E")};n.getEventTitle=function(t){var i=t.name+" \n";return i+n.getEventYearString(t.year)};n.getIntervalWidth=function(){var t=n.config.intervalWidth+"px";return{width:t}};n.selectTimeline=function(t){t.isSelected=!t.isSelected;n.setHighlights(t.id)};n.getHtmlEventText=function(n){var t=new showdown.Converter;return t.makeHtml(n)};n.getImageSrc=function(n){return n?n:"./placeholder.png"};n.$watch("sizes",function(){n.getCurrentEvents=function(n,t){return p(n,t)};n.getTimelineDetailsVoidWidth=function(n,t){var i=c(n,t)-10+"px";return{width:i}};n.getEventVoidWidth=function(n,t,i){var r=w(n,t,i)+"px";return{width:r}};n.getTimelineVoidWidth=function(n,t){var i=c(n,t)+"px";return{width:i}};n.getCompleteWidth=function(n,t){var i=k(n,t)+"px";return{width:i}};n.getUnknownStartWidth=function(n,t){var i=l(n,t)+"px";return{width:i}};n.getMainWidth=function(n,t){var i=o(n,t)+"px";return{width:i}};n.getUnknownEndWidth=function(n,t){var i=a(n,t)+"px";return{width:i}};n.getUnknownStartTimelineName=function(n,t){var i=l(n,t),r=o(n,t);return r===0&&i>0?n.name:""};n.getMainTimelineName=function(n,t){var i=o(n,t);return i>0?n.name:""};n.getUnknownEndTimelineName=function(n,t){var i=a(n,t),r=o(n,t);return r===0&&i>0?n.name:""}})}])})();